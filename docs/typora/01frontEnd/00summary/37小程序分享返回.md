# 37 小程序分享返回

https://developers.weixin.qq.com/community/develop/doc/00024066b40660bb00aab0b3d51400

## 1 分享实现

```javascript
  onLoad(query) {
    wx.showShareMenu({ withShareTicket: true,
      menus: ['shareAppMessage', 'shareTimeline']
    })
    // 获取服务ID，从网络获取商品详情
  },
```



## 2 自定义分享

自定义分享的标题，**传递参数**，分享朋友圈时更换图片。

分享朋友圈时query参数有可能拿不到，看下面标题3。

````js
onShareTimeline(res) { //分享到朋友圈
	return {
          title: this.form.title,
          query: 'from=share&id=' + this.opt.id,
	}
},
    
onShareAppMessage(res) { //发送给朋友
   return {
      title: this.form.title,
      path: 'pages/realTimeInfo/detail?from=share&id=' + this.opt.id,
      success: function(res) {
          // 转发成功
      },
      fail: function(res) {
          // 转发失败
      }
  }
},
````



## 3 判断是否为从分享入口进入的

分享朋友圈的query参数也能获取到。

以下方法在官方文档--api--基础---生命周期中。

```js
wx.getLaunchOptionsSync().scene == 1154 //朋友圈打开分享页
wx.getLaunchOptionsSync().scene == 1155 //通过分享页打开小程序

经测试
wx.getLaunchOptionsSync().scene == 1001 //正常进入
wx.getLaunchOptionsSync().scene == 1007 //通过分享朋友页打开小程序
// 1089 微信群打开，聊天主界面下拉，打开小程序/微信聊天主界面下拉，
```

关于场景状态码，如果直接搜索上面的方法，状态码可能不包含这些。

需要额外查文档，如下

> https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html

